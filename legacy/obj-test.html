<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ReeTracer JS</title>
</head>
<body>
<div class="container">
    <canvas id="reetracer-preview" style="width: 640px; height: 480px"></canvas>
    <canvas id="reetracer" style="width: 640px; height: 480px"></canvas>
    <canvas id="reetracer-high" style="width: 640px; height: 480px"></canvas>
    <canvas id="texture" style="display: none"></canvas>
</div>
<script src="reetracer/ReeTracer.js"></script>
<script src="reetracer/Scene.js"></script>
<script>

    var texture = null;

    var cvs = document.getElementById('texture');
    cvs.width = 1024;
    cvs.height = 1024;
    var ctx = document.getElementById('texture').getContext('2d');
    var img1 = new Image();
    img1.src = 'obj/space_frigate_6_color.png';

    //drawing of the test image - img1
    img1.onload = function () {
        //draw background image
        ctx.drawImage(img1, 0, 0, 1024, 1024);
        texture = ctx.getImageData(0, 0, 1024, 1024);
        initRenderer();
    };

    function initRenderer() {

        var objects = [
            {
                type: 'plane',
                position: [0, -2, 0],
                normal: [0, 1, 0],
                material: {
                    color: [50, 150, 50],
                    reflection: 0,
                    roughness: 0.1
                }
            }
            /*, {
                type: 'sphere',
                center: [-20, 2, 50],
                radius: 15,
                material: {
                    color: [255, 255, 255],
                    reflection: 0.5,
                    roughness: 0
                }
            }*//*, {
                type: 'obj',
                file: '/reetracer.js/obj/hydrant.obj',
                scale: 1.2,
                offset: [-4, -2, 7],
                rotate: [0, -0.2, 0],
                renderBackside: true,
                material: {
                    color: [255, 0, 0],
                    reflection: 0.1,
                    roughness: 0.2,
                    specular: 0.5
                }
            }*/, {
                type: 'obj',
                file: '/reetracer.js/obj/plane.obj',
                scale: 0.2,
                offset: [0.35, -0.9, 6],
                rotate: [0, Math.PI/4, 0],
                renderFlat: true,
                material: {
                    color: [255, 255, 255],
                    reflection: 0,
                    roughness: 0,
                    texture: texture
                }
            }, {
                type: 'obj',
                file: '/reetracer.js/obj/plane.obj',
                scale: 0.2,
                offset: [0.35, 5, 20],
                rotate: [0, Math.PI*0.7, 0],
                renderFlat: true,
                material: {
                    color: [255, 255, 255],
                    reflection: 0,
                    roughness: 0,
                    texture: texture
                }
            }, {
                type: 'obj',
                file: '/reetracer.js/obj/plane.obj',
                scale: 0.2,
                offset: [4, 9, 26],
                rotate: [0, Math.PI*0.7, 0],
                renderFlat: true,
                material: {
                    color: [255, 255, 255],
                    reflection: 0,
                    roughness: 0,
                    texture: texture
                }
            }
            /*, {
            type: 'polygon',
                points: [
                    [-2, 3, 7],
                    [2, 3, 7],
                    [2, -1, 7],
                    [-2, -1, 7],
                ],
                normals: [
                    [-1, 0, -1],
                    [1, -0, -1],
                    [1, -0, -1],
                    [-1, -0, -1],
                ],
                material: {
                    color: [255, 255, 255],
                    reflection: 0
                }
            }//*/
        ];

        //
        var reetracer = new ReeTracer('reetracer-preview', {
            objects: objects
        }, {
            width: 320,
            height: 240,
            ambientOcclusion: 0,
            softShadows: 0
        });
        reetracer.render(function(e){
            if (e.type == 'finished') {
                var reetracer = new ReeTracer('reetracer', {
                    objects: objects
                }, {
                    width: 640,
                    height: 480,
                    ambientOcclusion: 5,
                    softShadows: 2
                });
                reetracer.render(function(e){
                    if (e.type == 'finished') {
                        var reetracer = new ReeTracer('reetracer-high', {
                            objects: objects
                        }, {
                            width: 1280,
                            height: 960,
                            ambientOcclusion: 30,
                            softShadows: 15
                        });
                        reetracer.render();
                    }
                });
            }
        });
        /*/

         //*/
    }
</script>
<style type="text/css">
    canvas {
        position: absolute;
        top: 100px;
        left: 50%;
        margin-left: -320px;
    }
</style>
</body>
</html>